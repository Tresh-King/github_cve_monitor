<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>统计数据调试</title>
</head>
<body>
  <h1>统计数据调试页面</h1>
  
  <div>
    <h3>测试结果：</h3>
    <ul id="test-results"></ul>
  </div>
  
  <div>
    <h3>详细日志：</h3>
    <pre id="log-output" style="background: #f5f5f5; padding: 10px; overflow-x: auto;"></pre>
  </div>

  <script>
    const logOutput = document.getElementById('log-output');
    const testResults = document.getElementById('test-results');
    
    function log(message) {
      console.log(message);
      logOutput.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
    }
    
    function addResult(test, status, details) {
      const li = document.createElement('li');
      li.innerHTML = `<strong>${test}</strong>: <span style="color: ${status === 'SUCCESS' ? 'green' : 'red'}">${status}</span> - ${details}`;
      testResults.appendChild(li);
    }
    
    async function testAPIs() {
      log('开始测试各个API...');
      
      // 测试1: GitHub API
      try {
        log('测试GitHub API...');
        const apiResponse = await fetch('https://api.github.com/repos/adminlove520/github_cve_monitor');
        if (apiResponse.ok) {
          const data = await apiResponse.json();
          log('GitHub API响应成功');
          log('仓库创建时间: ' + data.created_at);
          log('API限制: ' + apiResponse.headers.get('X-RateLimit-Limit'));
          addResult('GitHub API', 'SUCCESS', `创建时间: ${data.created_at}, API限制: ${apiResponse.headers.get('X-RateLimit-Limit')}`);
        } else {
          throw new Error('响应状态: ' + apiResponse.status);
        }
      } catch (error) {
        log('GitHub API失败: ' + error.message);
        addResult('GitHub API', 'FAILED', error.message);
      }
      
      // 测试2: README.md
      try {
        log('测试README.md加载...');
        const readmeResponse = await fetch('README.md');
        if (readmeResponse.ok) {
          const markdown = await readmeResponse.text();
          log('README.md加载成功，长度: ' + markdown.length);
          
          // 分析内容
          const lines = markdown.split('\n');
          let totalRecords = '未找到';
          let updateTime = '未找到';
          let tableRows = 0;
          
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i];
            
            if (line.includes('生成时间') || line.includes('更新时间')) {
              const timeMatch = line.match(/(\d{4}-\d{2}-\d{2})/);
              if (timeMatch) {
                updateTime = timeMatch[1];
                log('找到更新时间: ' + updateTime);
              }
            }
            
            if (line.includes('总记录数') || line.includes('记录总数') || line.includes('Total')) {
              const countMatch = line.match(/(\d+)/);
              if (countMatch) {
                totalRecords = countMatch[1];
                log('找到总记录数: ' + totalRecords);
              }
            }
            
            if (line.startsWith('| [CVE-')) {
              tableRows++;
            }
          }
          
          log('表格行数: ' + tableRows);
          addResult('README.md', 'SUCCESS', `总记录数: ${totalRecords}, 更新时间: ${updateTime}, 表格行数: ${tableRows}`);
          
        } else {
          throw new Error('响应状态: ' + readmeResponse.status);
        }
      } catch (error) {
        log('README.md加载失败: ' + error.message);
        addResult('README.md', 'FAILED', error.message);
      }
      
      log('测试完成');
    }
    
    // 页面加载完成后开始测试
    document.addEventListener('DOMContentLoaded', testAPIs);
  </script>
</body>
</html>