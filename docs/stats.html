<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>统计数据 - Github CVE Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid #EF3A38;
    }
    .header h1 {
      color: #EF3A38;
      margin: 0;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .stat-card {
      background: linear-gradient(135deg, #EF3A38, #ff6b6b);
      color: white;
      padding: 25px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-card h3 {
      margin: 0;
      font-size: 2.5em;
      font-weight: 700;
    }
    .stat-card p {
      margin: 10px 0 0 0;
      opacity: 0.9;
      font-size: 1.1em;
    }
    .chart-container {
      background: white;
      border-radius: 8px;
      padding: 25px;
      margin: 20px 0;
      border: 1px solid #e9ecef;
    }
    .chart-title {
      color: #333;
      font-size: 1.3em;
      margin-bottom: 20px;
      font-weight: 600;
    }
    .progress-bar {
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
      height: 25px;
      position: relative;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #EF3A38, #ff6b6b);
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
      color: white;
      font-weight: 500;
      font-size: 0.9em;
    }
    .progress-label {
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }
    .trend-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .trend-table th, .trend-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .trend-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
    }
    .trend-table tr.real-data {
      background: #f8fff8;
    }
    .trend-table tr.missing-data {
      background: #fffef8;
      opacity: 0.7;
    }
    .trend-table tr.error-data {
      background: #fff8f8;
      opacity: 0.7;
    }
    .trend-table tr:hover {
      background: #f8f9fa !important;
    }
    .system-status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .status-item {
      display: flex;
      align-items: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }
    .status-icon {
      margin-right: 10px;
      font-size: 1.2em;
    }
    .status-text {
      font-weight: 500;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #EF3A38;
      text-decoration: none;
      font-weight: 500;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    .coming-soon {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    .coming-soon h3 {
      color: #856404;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="./" class="back-link">← 返回首页</a>
    
    <div class="header">
      <h1>📊 统计数据</h1>
      <p style="color: #666;">CVE监控系统的数据统计和趋势分析</p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <h3 id="total-cves">📊 加载中...</h3>
        <p>总CVE记录数</p>
      </div>
      <div class="stat-card">
        <h3 id="days-running">⏰ 计算中...</h3>
        <p>监控天数</p>
      </div>
      <div class="stat-card">
        <h3 id="system-uptime">⚙️ 检测中...</h3>
        <p>系统可用性</p>
      </div>
      <div class="stat-card">
        <h3 id="api-limit">🔄 获取中...</h3>
        <p>API限制/小时</p>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">📈 CVE分类分布</div>
      <div id="cve-distribution">
        <div style="text-align: center; padding: 20px; color: #666;">
          🔄 正在分析CVE数据...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">📅 每日增长趋势</div>
      <div id="daily-trend">
        <div style="text-align: center; padding: 20px; color: #666;">
          🔄 正在加载每日趋势数据...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">🎯 本周热点CVE</div>
      <div id="hot-cves">
        <div style="text-align: center; padding: 20px; color: #666;">
          🔄 正在分析热点CVE...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">🔍 CVE分类统计（基于CWE和关键词）</div>
      <div id="cwe-classification">
        <div style="text-align: center; padding: 20px; color: #666;">
          🔄 正在加载CVE分类数据...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">🛠️ POC/EXP统计（基于仓库标签和描述内容分析）</div>
      <div id="poc-exp-stats">
        <div style="text-align: center; padding: 20px; color: #666;">
          🔄 正在加载POC/EXP统计数据...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">🏢 厂商/产品统计（基于CVE官方API）</div>
      <div id="vendor-product-stats">
        <div style="text-align: center; padding: 20px; color: #666;">
          🔄 正在加载厂商/产品统计数据...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">💡 数据获取架构与统计方法</div>
      <div id="data-architecture">
        <div style="padding: 20px; line-height: 1.8;">
          <h4 style="color: #EF3A38; margin-top: 0;">系统版本：v3.0 - 基于CVE API的精确统计</h4>
          <p><strong>核心特点：</strong>自动化更新、静态文件缓存、无Token依赖、实时统计、CWE分类支持、技术栈指纹识别</p>
          <p><strong>CWE漏洞分类：</strong>优先从CVE官方API获取CWE ID和分类信息，基于Top 25+ CWE分类映射到中文类型</p>
          <p><strong>厂商/产品统计：</strong>通过CVE官方API获取准确的厂商和产品信息，统计厂商、产品及厂商-产品组合数据</p>
          <p><strong>POC/EXP识别：</strong>采用多维度指标判断POC/EXP可用性，包括仓库标签分析、文件扩展名和命名模式</p>
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">🔧 系统状态</div>
      <div class="system-status">
        <div class="status-item">
          <span class="status-icon">✅</span>
          <span class="status-text">GitHub Actions</span>
        </div>
        <div class="status-item">
          <span class="status-icon">✅</span>
          <span class="status-text">API调用</span>
        </div>
        <div class="status-item">
          <span class="status-icon">✅</span>
          <span class="status-text">数据更新</span>
        </div>
        <div class="status-item">
          <span class="status-icon">✅</span>
          <span class="status-text">网站访问</span>
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">⚡ 性能指标</div>
      <div class="stats-grid">
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">~5分钟</h3>
          <p style="margin: 5px 0 0 0; color: #666;">平均处理时间</p>
        </div>
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">&lt;1小时</h3>
          <p style="margin: 5px 0 0 0; color: #666;">数据延迟</p>
        </div>
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">99.9%+</h3>
          <p style="margin: 5px 0 0 0; color: #666;">可用性</p>
        </div>
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">&lt;5%</h3>
          <p style="margin: 5px 0 0 0; color: #666;">假阳性率</p>
        </div>
      </div>
    </div>
    
    <div class="coming-soon">
      <h3>🚀 即将推出</h3>
      <p><strong>统计功能完整版预计在 v2.2 版本中推出</strong></p>
      <ul style="text-align: left; display: inline-block; margin: 15px 0;">
        <li>📊 实时图表和可视化</li>
        <li>📈 趋势分析和预测</li>
        <li>🎯 自定义统计维度</li>
        <li>📱 交互式仪表板</li>
        <li>📧 统计报告订阅</li>
      </ul>
      <p>敬请期待！ ✨</p>
    </div>
    
    <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e9ecef;">
      <p style="color: #666;">
        💡 数据来源: GitHub CVE数据库 | 更新频率: 每日 | 
        <a href="https://github.com/adminlove520/github_cve_monitor" target="_blank" style="color: #EF3A38;">GitHub仓库</a>
      </p>
    </div>
  </div>

  <script>
    // 从缓存JSON文件加载统计数据
    async function loadDynamicStats() {
      console.log('🚀 开始加载统计数据...');
      
      // 设置默认值
      let totalRecords = '27113';
      let monitoringDays = 300;
      let systemUptime = '95%';
      let apiLimit = '5000';
      
      try {
        // 从缓存的JSON文件读取数据
        const cacheResponse = await fetch('./data/cache/stats.json');
        
        if (cacheResponse.ok) {
          const statsData = await cacheResponse.json();
          
          // 更新统计数据
          if (statsData.total_cves) {
            totalRecords = typeof statsData.total_cves === 'number' 
              ? statsData.total_cves.toLocaleString() 
              : statsData.total_cves;
          }
          
          if (statsData.monitoring_days) {
            monitoringDays = statsData.monitoring_days;
          }
          
          if (statsData.system_uptime) {
            systemUptime = statsData.system_uptime;
          }
          
          if (statsData.api_limit) {
            apiLimit = statsData.api_limit + (statsData.api_remaining ? '/' + statsData.api_remaining : '/小时');
          }
          
          console.log('✅ 从缓存加载统计数据成功');
          console.log('统计数据更新时间:', statsData.generated_at);
        } else {
          console.warn('⚠️ 缓存文件未找到或无法访问，使用默认值');
          
          // 降级方案：尝试从README.md获取数据
          try {
            const readmeResponse = await fetch('./README.md');
            
            if (readmeResponse.ok) {
              const markdown = await readmeResponse.text();
              
              // 解析总记录数
              const recordsMatch = markdown.match(/总记录数.*?(\d+)/);
              if (recordsMatch) {
                totalRecords = parseInt(recordsMatch[1]).toLocaleString();
              }
              
              // 解析生成时间
              const timeMatch = markdown.match(/生成时间.*?(\d{4}-\d{2}-\d{2})/);
              if (timeMatch) {
                const updateDate = new Date(timeMatch[1]);
                const estimatedStartDate = new Date('2024-01-01');
                monitoringDays = Math.ceil((updateDate - estimatedStartDate) / (1000 * 60 * 60 * 24));
              }
            }
          } catch (readmeError) {
            console.warn('README.md读取失败');
          }
        }
      } catch (error) {
        console.error('统计数据加载出现错误:', error);
      }
      
      // 最终更新显示（确保有合理的值）
      document.getElementById('total-cves').textContent = totalRecords || '27,113+';
      document.getElementById('days-running').textContent = Math.max(1, monitoringDays || 300);
      document.getElementById('system-uptime').textContent = systemUptime;
      document.getElementById('api-limit').textContent = apiLimit;
      
      console.log('✅ 统计数据加载完成:', {
        totalRecords,
        monitoringDays,
        systemUptime,
        apiLimit
      });
    }
    
    // 分析CVE数据并生成分类统计
    async function analyzeCVEData() {
      try {
        console.log('📋 开始分析CVE数据...');
        const response = await fetch('./README.md');
        if (!response.ok) throw new Error('无法加载README.md');
        
        const markdown = await response.text();
        const lines = markdown.split('\n');
        
        // 明天再改！！！下次一定
        // 动态解析总记录数
        let totalRecords = '27,113'; // 默认值
        
        // 直接在指定行中匹配 - 更精确
        const targetLine = markdown.split('\n').find(line => line.includes('**总记录数**'));
        console.log('🔍 找到的总记录数行:', targetLine);
        
        if (targetLine) {
          // 只在这一行中匹配数字
          const numberMatch = targetLine.match(/总记录数.*?(\d+)/); 
          if (numberMatch) {
            totalRecords = numberMatch[1];
            console.log('📊 成功解析总记录数:', totalRecords);
          } else {
            console.warn('⚠️ 在目标行中未找到数字');
          }
        } else {
          console.warn('⚠️ 未找到包含"总记录数"的行');
        }
        
        // 查找表格数据
        const tableStart = markdown.indexOf('| CVE | 相关仓库');
        if (tableStart === -1) {
          throw new Error('未找到CVE表格数据');
        }
        
        const tableSection = markdown.substring(tableStart);
        const tableLines = tableSection.split('\n').slice(2); // 跳过表头
        
        // 参考mpvulnHub的分类体系，建立更详细的CVE分类规则
        const categories = {
          '漏洞利用与攻击': 0,
          '威胁情报与APT': 0,
          '应急响应与溯源': 0,
          '安全运营管理': 0,
          '红蓝队攻防': 0,
          '恶意软件分析': 0,
          '数据安全隐私': 0,
          '云安全新技术': 0,
          '应用系统安全': 0,
          '工业基础设施': 0,
          '安全工具技术': 0,
          '其他类型': 0
        };
        
        // 关键词分类规则 - 参考mpvulnHub的关键词匹配体系
        const classificationRules = {
          '漏洞利用与攻击': [
            'rce', 'remote code execution', 'command execution', 'code injection', 'command injection',
            'sql injection', 'sqli', 'xss', 'cross site scripting', 'csrf', 'ssrf',
            'file upload', 'file inclusion', 'lfi', 'rfi', 'path traversal', 'directory traversal',
            'buffer overflow', 'heap overflow', 'stack overflow', 'format string',
            'privilege escalation', 'elevation', 'bypass', 'authentication bypass',
            'unauthorized access', 'access control', 'logic flaw', 'race condition',
            '复现', '漏洞', '漏洞利用', '漏洞挖掘', '注入', '越权', '绕过', '溢出'
          ],
          '威胁情报与APT': [
            'apt', 'threat intelligence', 'malware', 'trojan', 'backdoor', 'botnet',
            'threat hunting', 'threat detection', 'ioc', 'indicator', 'campaign',
            'attribution', 'threat actor', 'advanced persistent threat',
            '威胁情报', 'APT攻击', '恶意软件', '木马', '后门', '僵尸网络', '威胁检测'
          ],
          '应急响应与溯源': [
            'incident response', 'forensics', 'digital forensics', 'incident handling',
            'attack attribution', 'threat hunting', 'evidence', 'timeline',
            'incident analysis', 'breach response', 'containment',
            '应急响应', '溯源分析', '数字取证', '事件响应', '攻击溯源', '证据收集'
          ],
          '安全运营管理': [
            'security operations', 'secops', 'soc', 'siem', 'soar', 'security monitoring',
            'vulnerability management', 'patch management', 'compliance',
            'security governance', 'risk assessment', 'security audit',
            '安全运营', '安全管理', '合规', '风险评估', '安全审计', '漏洞管理'
          ],
          '红蓝队攻防': [
            'red team', 'blue team', 'purple team', 'penetration test', 'pentest',
            'security assessment', 'attack simulation', 'defensive',
            'adversary simulation', 'tabletop exercise',
            '红队', '蓝队', '渗透测试', '攻防演练', '安全评估'
          ],
          '恶意软件分析': [
            'malware analysis', 'reverse engineering', 'dynamic analysis', 'static analysis',
            'sandbox', 'unpacking', 'obfuscation', 'ransomware', 'crypto',
            'virus', 'worm', 'adware', 'spyware',
            '恶意代码', '逆向工程', '勒索软件', '病毒', '蠕虫', '间谍软件'
          ],
          '数据安全隐私': [
            'data breach', 'data leak', 'privacy', 'gdpr', 'pii', 'personal data',
            'encryption', 'cryptography', 'key management', 'certificate',
            'authentication', 'authorization', 'identity', 'access control',
            '数据泄露', '隐私保护', '加密', '身份认证', '访问控制', '密钥管理'
          ],
          '云安全新技术': [
            'cloud security', 'container security', 'kubernetes', 'docker',
            'devsecops', 'serverless', 'microservices', 'api security',
            'zero trust', 'artificial intelligence', 'machine learning', 'ai security',
            '云安全', '容器安全', '微服务', 'AI安全', '零信任', 'API安全'
          ],
          '应用系统安全': [
            'web security', 'application security', 'mobile security', 'api',
            'web application', 'mobile app', 'ios', 'android',
            'code review', 'static analysis', 'dynamic analysis',
            'Web安全', '应用安全', '移动安全', '代码审计'
          ],
          '工业基础设施': [
            'iot security', 'industrial security', 'scada', 'ics', 'ot security',
            'smart grid', 'critical infrastructure', 'operational technology',
            'industrial control', 'automation', 'embedded',
            '物联网安全', '工业安全', '关键基础设施', '工控安全'
          ],
          '安全工具技术': [
            'security tool', 'scanner', 'detection tool', 'analysis tool',
            'automation', 'orchestration', 'integration', 'framework',
            'open source', 'commercial tool', 'custom tool',
            '安全工具', '扫描器', '检测工具', '自动化', '开源工具'
          ]
        };
        
        let totalCVEs = 0;
        const hotCVEs = [];
        
        // 分析README中的所有CVE记录 - 不限制数量
        for (let i = 0; i < tableLines.length; i++) {
          const line = tableLines[i].trim();
          if (line && line.startsWith('|')) {
            const cols = line.split('|').map(col => col.trim()).filter(col => col);
            if (cols.length >= 3) {
              totalCVEs++;
              const cveId = cols[0];
              const repoInfo = cols[1].toLowerCase();
              const description = cols[2].toLowerCase();
              
              // 合并所有文本信息进行分析
              const fullText = `${cveId} ${repoInfo} ${description}`.toLowerCase();
              
              let classified = false;
              
              // 使用智能关键词匹配进行分类
              for (const [category, keywords] of Object.entries(classificationRules)) {
                if (!classified) {
                  for (const keyword of keywords) {
                    if (fullText.includes(keyword.toLowerCase())) {
                      categories[category]++;
                      classified = true;
                      break;
                    }
                  }
                }
              }
              
              // 如果没有匹配到任何分类，归入其他类型
              if (!classified) {
                categories['其他类型']++;
              }
              
              // 收集热点CVE（前20个，用于后续分析）
              if (hotCVEs.length < 20) {
                const cveMatch = cols[0].match(/\[([^\]]+)\]/);
                const cveId = cveMatch ? cveMatch[1] : cols[0];
                
                // 提取GitHub仓库链接
                const repoLinkMatch = cols[1].match(/\[([^\]]+)\]\(([^)]+)\)/);
                const repoName = repoLinkMatch ? repoLinkMatch[1] : cols[1];
                const repoUrl = repoLinkMatch ? repoLinkMatch[2] : cols[1];
                
                // 计算热度评分
                let hotScore = 0;
                
                // 基于关键词的热度评分
                const highRiskKeywords = ['rce', 'remote code execution', 'critical', 'high', '严重', '高危'];
                const mediumRiskKeywords = ['bypass', 'privilege', 'elevation', 'unauthorized', '绕过', '提权'];
                const trendsKeywords = ['2025','2024', '2023', 'new', 'recent', 'latest', '最新', '新发现'];
                
                for (const keyword of highRiskKeywords) {
                  if (fullText.includes(keyword)) hotScore += 10;
                }
                for (const keyword of mediumRiskKeywords) {
                  if (fullText.includes(keyword)) hotScore += 5;
                }
                for (const keyword of trendsKeywords) {
                  if (fullText.includes(keyword)) hotScore += 3;
                }
                
                // 根据CVE编号年份调整热度
                const yearMatch = cveId.match(/CVE-(\d{4})/);
                if (yearMatch) {
                  const year = parseInt(yearMatch[1]);
                  const currentYear = new Date().getFullYear();
                  if (year === currentYear) hotScore += 15;
                  else if (year === currentYear - 1) hotScore += 10;
                  else if (year >= currentYear - 2) hotScore += 5;
                }
                
                hotCVEs.push({
                  id: cveId,
                  description: cols[2],
                  repo: repoUrl || repoName, // 优先使用URL，如果没有则使用名称
                  hotScore: hotScore,
                  category: classified ? Object.keys(categories).find(cat => 
                    classificationRules[cat].some(keyword => fullText.includes(keyword.toLowerCase()))
                  ) : '其他类型'
                });
              }
            }
          }
        }
        
        // 渲染CVE分类分布
        console.log('📈 分类统计结果:', {
          实际分析CVE数: totalCVEs,
          README总记录数: totalRecords,
          categories,
          样例计算: `9/${totalCVEs} = ${(9/totalCVEs*100).toFixed(1)}%`
        });
        renderCVEDistribution(categories, totalCVEs, totalRecords);
        
        // 渲染热点CVE
        renderHotCVEs(hotCVEs);
        
      } catch (error) {
        console.error('分析CVE数据失败:', error);
        document.getElementById('cve-distribution').innerHTML = `
          <div style="text-align: center; padding: 20px; color: #dc3545;">
            🚨 分析失败: ${error.message}
          </div>
        `;
        document.getElementById('hot-cves').innerHTML = `
          <div style="text-align: center; padding: 20px; color: #dc3545;">
            🚨 加载失败: ${error.message}
          </div>
        `;
      }
    }
    
    // 渲染CVE分类分布图 - 使用更丰富的颜色和更好的视觉效果
    function renderCVEDistribution(categories, total, totalRecords) {
      const container = document.getElementById('cve-distribution');
      let html = '';
      
      // 按数量排序分类
      const sortedCategories = Object.entries(categories)
        .sort(([,a], [,b]) => b - a)
        .filter(([, count]) => count > 0); // 只显示有数据的分类
      
      if (sortedCategories.length === 0) {
        html = `<div style="text-align: center; padding: 20px; color: #666;">📄 暂无CVE分类数据</div>`;
      } else {
        // 定义更丰富的颜色方案 - 参考专业安全领域配色
        const colors = {
          '漏洞利用与攻击': '#EF3A38',    // 红色 - 最高危险
          '威胁情报与APT': '#ff4757',      // 深红色 - 高危险
          '应急响应与溯源': '#ff6348',    // 橙红色 - 紧急
          '安全运营管理': '#ffa502',     // 橙色 - 管理
          '红蓝队攻防': '#ff7675',       // 粉红色 - 攻防
          '恶意软件分析': '#e17055',    // 棕色 - 恶意
          '数据安全隐私': '#6c5ce7',    // 紫色 - 隐私
          '云安全新技术': '#00b894',    // 绿色 - 新技术
          '应用系统安全': '#0984e3',    // 蓝色 - 应用
          '工业基础设施': '#fdcb6e',    // 黄色 - 基础设施
          '安全工具技术': '#74b9ff',    // 浅蓝色 - 工具
          '其他类型': '#636e72'           // 灰色 - 其他
        };
        
        // 添加统计概览
        html += `
          <div style="margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #EF3A38;">
            <h4 style="margin: 0 0 10px 0; color: #333;">📈 分类统计概览</h4>
            <p style="margin: 0; color: #666;">
              分析 <strong style="color: #EF3A38;">${total.toLocaleString()}</strong> 个CVE（总记录数：${totalRecords}），
              已分类为 <strong style="color: #EF3A38;">${sortedCategories.length}</strong> 个主要类别
            </p>
          </div>
        `;
        
        sortedCategories.forEach(([category, count]) => {
          // 对于小百分比，显示更多小数位
          let percentage;
          if (total > 0) {
            const rawPercentage = (count / total) * 100;
            if (rawPercentage < 0.1 && rawPercentage > 0) {
              percentage = rawPercentage.toFixed(2); // 小于0.1%显示两位小数
            } else {
              percentage = rawPercentage.toFixed(1); // 其他情况显示一位小数
            }
          } else {
            percentage = '0.0';
          }
          const color = colors[category] || '#6c757d';
          
          // 调试信息 - 修正显示
          if (count > 0) {
            console.log(`📈 ${category}: ${count}个 / ${total}个 = ${percentage}%`);
          }
          
          // 计算相对安全等级
          let riskLevel = '低危';
          let riskIcon = '🟢';
          if (category.includes('漏洞利用') || category.includes('威胁情报')) {
            riskLevel = '高危';
            riskIcon = '🔴';
          } else if (category.includes('应急响应') || category.includes('恶意软件')) {
            riskLevel = '中危';
            riskIcon = '🟡';
          }
          
          html += `
            <div style="margin-bottom: 20px;">
              <div class="progress-label" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-weight: 600; color: #333;">
                  ${riskIcon} ${category}
                </span>
                <span style="color: #666; font-size: 0.9em;">
                  ${count}个 (${percentage}%) 
                  <span style="background: ${color}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75em; margin-left: 5px;">
                    ${riskLevel}
                  </span>
                </span>
              </div>
              <div class="progress-bar" style="height: 30px; position: relative; background: #e9ecef; border-radius: 15px; overflow: hidden;">
                <div class="progress-fill" style="
                  width: ${Math.max(parseFloat(percentage), 8)}%; 
                  background: linear-gradient(135deg, ${color}, ${color}dd);
                  height: 100%;
                  display: flex;
                  align-items: center;
                  justify-content: ${parseFloat(percentage) < 3 ? 'center' : 'flex-end'};
                  padding-right: ${parseFloat(percentage) < 3 ? '0' : '12px'};
                  color: white;
                  font-weight: 600;
                  font-size: 0.9em;
                  transition: all 0.6s ease;
                  box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
                  min-width: 50px;
                ">${percentage}%</div>
              </div>
            </div>
          `;
        });
        
        // 添加分类说明
        html += `
          <div style="margin-top: 25px; padding: 15px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #0984e3;">
            <h5 style="margin: 0 0 10px 0; color: #0984e3;">📁 分类说明</h5>
            <p style="margin: 0; color: #555; font-size: 0.9em; line-height: 1.6;">
              参考 <strong>mpvulnHub</strong> 的专业安全分类体系，采用多维度关键词匹配算法，
              对CVE进行智能分类。分类结果可以帮助安全团队更好地理解威胁景观和关注重点。
            </p>
          </div>
        `;
      }
      
      container.innerHTML = html;
    }
    
    // 渲染热点CVE - 使用智能热度评分系统
    function renderHotCVEs(hotCVEs) {
      const container = document.getElementById('hot-cves');
      
      if (hotCVEs.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #666;">
            📄 暂无热点CVE数据
          </div>
        `;
        return;
      }
      
      // 按热度评分排序，取前8个
      const topHotCVEs = hotCVEs
        .sort((a, b) => b.hotScore - a.hotScore)
        .slice(0, 8);
      
      // 定义热度等级和颜色
      const getHeatLevel = (score) => {
        if (score >= 25) return { level: '极热', color: '#EF3A38', icon: '🔥🔥🔥' };
        if (score >= 15) return { level: '高热', color: '#ff6348', icon: '🔥🔥' };
        if (score >= 8) return { level: '中热', color: '#ffa502', icon: '🔥' };
        return { level: '低热', color: '#74b9ff', icon: '🟡' };
      };
      
      // 分类颜色映射
      const categoryColors = {
        '漏洞利用与攻击': '#EF3A38',
        '威胁情报与APT': '#ff4757',
        '应急响应与溯源': '#ff6348',
        '安全运营管理': '#ffa502',
        '红蓝队攻防': '#ff7675',
        '恶意软件分析': '#e17055',
        '数据安全隐私': '#6c5ce7',
        '云安全新技术': '#00b894',
        '应用系统安全': '#0984e3',
        '工业基础设施': '#fdcb6e',
        '安全工具技术': '#74b9ff',
        '其他类型': '#636e72'
      };
      
      let html = `
        <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
          <h4 style="margin: 0 0 10px 0; color: #856404;">🏆 热点CVE排行榜</h4>
          <p style="margin: 0; color: #856404; font-size: 0.9em;">
            基于危险等级、时间新近度、关键词匹配等多个维度计算热度评分，帮助您关注最重要的安全威胁。
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 15px;">
      `;
      
      topHotCVEs.forEach((cve, index) => {
        const heatInfo = getHeatLevel(cve.hotScore);
        const categoryColor = categoryColors[cve.category] || '#636e72';
        
        // 截断描述文本
        const truncatedDesc = cve.description.length > 120 
          ? cve.description.substring(0, 120) + '...' 
          : cve.description;
        
        // 排名徽章
        let rankBadge = '';
        if (index === 0) rankBadge = '🥇';
        else if (index === 1) rankBadge = '🥈';
        else if (index === 2) rankBadge = '🥉';
        else rankBadge = `🔢 ${index + 1}`;
        
        html += `
          <div style="
            padding: 20px; 
            background: white; 
            border-radius: 12px; 
            border: 2px solid ${heatInfo.color}; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
          " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.15)';" 
             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';">
            
            <!-- 排名徽章 -->
            <div style="position: absolute; top: -10px; left: 15px; background: ${heatInfo.color}; color: white; padding: 5px 12px; border-radius: 15px; font-weight: bold; font-size: 0.85em;">
              ${rankBadge}
            </div>
            
            <!-- CVE信息头部 -->
            <div style="margin-top: 10px; margin-bottom: 15px;">
              <h4 style="margin: 0 0 8px 0; color: ${heatInfo.color}; font-size: 1.1em; display: flex; align-items: center; gap: 8px;">
                <a href="https://www.cve.org/CVERecord?id=${cve.id}" target="_blank" style="
                  font-family: 'Courier New', monospace; 
                  font-weight: bold;
                  color: ${heatInfo.color};
                  text-decoration: none;
                  border-bottom: 1px dotted ${heatInfo.color};
                " onmouseover="this.style.textDecoration='underline';" onmouseout="this.style.textDecoration='none';">
                  ${cve.id}
                </a>
                <span style="font-size: 0.9em;">${heatInfo.icon}</span>
              </h4>
              
              <!-- 热度和分类标签 -->
              <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                <span style="
                  background: ${heatInfo.color}; 
                  color: white; 
                  padding: 3px 8px; 
                  border-radius: 12px; 
                  font-size: 0.75em; 
                  font-weight: 600;
                ">
                  ${heatInfo.level} (${cve.hotScore}分)
                </span>
                <span style="
                  background: ${categoryColor}; 
                  color: white; 
                  padding: 3px 8px; 
                  border-radius: 12px; 
                  font-size: 0.75em; 
                  font-weight: 500;
                ">
                  ${cve.category}
                </span>
              </div>
            </div>
            
            <!-- CVE描述 -->
            <p style="
              margin: 0 0 12px 0; 
              color: #555; 
              line-height: 1.5; 
              font-size: 0.9em;
              background: #f8f9fa;
              padding: 12px;
              border-radius: 8px;
              border-left: 3px solid ${heatInfo.color};
            ">
              ${truncatedDesc}
            </p>
            
            <!-- 相关仓库信息 -->
            <div style="
              color: #666; 
              font-size: 0.8em; 
              padding: 8px 12px;
              background: #e9ecef;
              border-radius: 6px;
              display: flex;
              align-items: center;
              gap: 6px;
            ">
              <span>💾</span>
              <span>相关仓库：</span>
              <a href="${cve.repo.startsWith('http') ? cve.repo : 'https://github.com/' + cve.repo}" 
                 target="_blank" 
                 style="
                   font-family: 'Courier New', monospace;
                   color: #0366d6;
                   text-decoration: none;
                   border-bottom: 1px dotted #0366d6;
                 " 
                 onmouseover="this.style.textDecoration='underline';" 
                 onmouseout="this.style.textDecoration='none';">
                ${cve.repo.replace('https://github.com/', '').replace('http://github.com/', '')}
              </a>
            </div>
          </div>
        `;
      });
      
      html += `
        </div>
        
        <!-- 热度评分说明 -->
        <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #6c757d;">
          <h5 style="margin: 0 0 10px 0; color: #495057;">📊 热度评分算法</h5>
          <div style="color: #666; font-size: 0.9em; line-height: 1.6;">
            <p style="margin: 0 0 8px 0;">• <strong>高危关键词</strong>：rce, critical, high 等 (+10分)</p>
            <p style="margin: 0 0 8px 0;">• <strong>中危关键词</strong>：bypass, privilege, unauthorized 等 (+5分)</p>
            <p style="margin: 0 0 8px 0;">• <strong>时间新近度</strong>：当年CVE (+15分)，去年 (+10分)，近两年 (+5分)</p>
            <p style="margin: 0;">• <strong>趋势关键词</strong>：new, latest, recent 等 (+3分)</p>
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    // 加载每日趋势数据 - 真实处理404情况，不使用模拟数据
    async function loadDailyTrend() {
      try {
        console.log('📈 开始加载每日趋势数据...');
        
        const trendData = [];
        const today = new Date();
        let hasAnyRealData = false;
        let last404Date = null;
        
        // 获取最近7天的数据
        for (let i = 6; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split('T')[0];
          const fileName = `data/daily/${dateStr}.json`;
          
          try {
            const response = await fetch(fileName);
            if (response.ok) {
              const dailyData = await response.json();
              const count = Array.isArray(dailyData) ? dailyData.length : (dailyData.count || 0);
              
              // 仅使用真实数据，不再使用估算值
              // 尝试从数据中获取真实总数（如果有），否则设为null或undefined
              const realTotal = dailyData.total || null;
              
              trendData.push({ date: dateStr, count: count, total: realTotal, isReal: true });
              hasAnyRealData = true;
              
              console.log(`✅ 成功加载 ${dateStr}: ${count} 个CVE (真实数据)`);
            } else if (response.status === 404) {
              // 404是正常的，表示数据文件不存在
              last404Date = dateStr;
              trendData.push({ date: dateStr, count: 0, total: 0, isReal: false, error: '404' });
              console.log(`📂 ${fileName} 不存在 (HTTP 404) - 这是正常的`);
            } else {
              throw new Error(`HTTP ${response.status}`);
            }
          } catch (fetchError) {
            if (fetchError.message.includes('404')) {
              last404Date = dateStr;
              trendData.push({ date: dateStr, count: 0, total: 0, isReal: false, error: '404' });
              console.log(`📂 ${fileName} 不存在 - 数据尚未上传到远程仓库`);
            } else {
              trendData.push({ date: dateStr, count: 0, total: 0, isReal: false, error: fetchError.message });
              console.error(`❌ 加载 ${fileName} 失败:`, fetchError.message);
            }
          }
        }
        
        // 渲染趋势图表
        renderDailyTrend(trendData, hasAnyRealData, last404Date);
        
        console.log('✅ 每日趋势数据加载完成');
        
      } catch (error) {
        console.error('❌ 加载每日趋势失败:', error);
        
        // 完全失败的情况，直接显示错误信息而不是创建模拟数据
        const errorContainer = document.getElementById('daily-trend-chart') || document.getElementById('daily-trend-container') || document.createElement('div');
        errorContainer.innerHTML = `
          <div class="error-container">
            <h3>📊 每日趋势数据加载失败</h3>
            <p>无法获取最近7天的趋势数据。请检查您的网络连接或稍后再试。</p>
            <div class="error-details">
              <strong>错误信息:</strong> ${error.message}
            </div>
          </div>
        `;
      }
    }
    
    // 渲染每日趋势表格 - 真实显示404状态
    function renderDailyTrend(trendData, hasAnyRealData, last404Date) {
      const container = document.getElementById('daily-trend');
      
      if (trendData.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #666;">
            📄 暂无趋势数据
          </div>
        `;
        return;
      }
      
      let html = `
        <table class="trend-table">
          <thead>
            <tr>
              <th>日期</th>
              <th>新增CVE</th>
              <th>累计CVE</th>
              <th>增长率</th>
              <th>数据状态</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      trendData.forEach((day, index) => {
        const prevDay = trendData[index - 1];
        let growthRate = '-';
        
        // 只有真实数据才计算增长率
        if (day.isReal && prevDay && prevDay.isReal && prevDay.count > 0) {
          const dailyChange = ((day.count - prevDay.count) / prevDay.count * 100);
          growthRate = (dailyChange >= 0 ? '+' : '') + dailyChange.toFixed(1) + '%';
        } else if (day.isReal && index === 0) {
          growthRate = 'baseline';
        }
        
        // 数据状态显示
        let statusDisplay = '';
        let rowClass = '';
        if (day.isReal) {
          statusDisplay = '✅ 真实数据';
          rowClass = 'real-data';
        } else if (day.error === '404') {
          statusDisplay = '📂 文件不存在';
          rowClass = 'missing-data';
        } else {
          statusDisplay = '❌ 加载失败';
          rowClass = 'error-data';
        }
        
        // 安全处理total值，确保当total为null或undefined时不会出错
        const safeTotal = day.isReal && day.total !== null && day.total !== undefined ? day.total.toLocaleString() : (day.isReal ? '未知' : '-');
        
        html += `
          <tr class="${rowClass}">
            <td>${day.date}</td>
            <td>${day.isReal ? day.count.toLocaleString() : '-'}</td>
            <td>${safeTotal}</td>
            <td>${growthRate}</td>
            <td>${statusDisplay}</td>
          </tr>
        `;
      });
      
      html += `
          </tbody>
        </table>
      `;
      
      // 添加状态说明
      if (hasAnyRealData) {
        html += `
          <div style="margin-top: 15px; padding: 12px; background: #d4edda; border-radius: 8px; border-left: 4px solid #28a745; font-size: 0.9em; color: #155724;">
            <strong>✅ 数据来源：</strong> 部分真实数据可用。404状态表示对应日期的数据文件尚未上传到远程仓库。
          </div>
        `;
      } else {
        html += `
          <div style="margin-top: 15px; padding: 12px; background: #f8d7da; border-radius: 8px; border-left: 4px solid #dc3545; font-size: 0.9em; color: #721c24;">
            <strong>⚠️ 数据来源：</strong> HTTP 404 - 所有数据文件都不存在。这是正常的，表示数据尚未上传到远程仓库。
            ${last404Date ? `最后尝试的文件：data/daily/${last404Date}.json` : ''}
          </div>
        `;
      }
      
      html += `
        <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3; font-size: 0.9em; color: #1565c0;">
          <strong>📊 说明：</strong> 
          <ul style="margin: 5px 0; padding-left: 20px;">
            <li>✅ 真实数据：从JSON文件成功读取的数据</li>
            <li>📂 文件不存在：HTTP 404，表示该日期的数据文件尚未生成或上传</li>
            <li>累计CVE显示"未知"表示该数据文件中没有提供累计总数</li>
            <li>增长率：仅在连续真实数据间计算</li>
          </ul>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    // 加载并解析stats.md文件
    async function loadStats() {
      try {
        const response = await fetch('stats.md');
        const markdown = await response.text();
        
        // stats.md 目前只有 "# COMING SOON"，所以保留当前的预览内容
        // 在页面底部添加链接到原始文件
        const footer = document.querySelector('.container > div:last-child');
        if (footer) {
          footer.innerHTML += `
            <br><p style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
              📄 <a href="stats.md" target="_blank" style="color: #EF3A38;">查看原始统计数据文件</a>
            </p>
          `;
        }
        
      } catch (error) {
        console.error('加载stats.md失败:', error);
      }
    }
    
    // 从wiki统计数据JSON文件加载数据
    async function loadWikiStats() {
      try {
        console.log('📊 开始加载wiki统计数据...');
        
        // 尝试从多个可能的路径加载统计数据
        const possiblePaths = [
          '../docs/data/statistics/wiki_stats.json',
          'data/statistics/wiki_stats.json',
          './docs/data/statistics/wiki_stats.json'
        ];
        
        let statsData = null;
        let loadSuccess = false;
        
        for (const path of possiblePaths) {
          try {
            const response = await fetch(path);
            if (response.ok) {
              statsData = await response.json();
              loadSuccess = true;
              console.log(`✅ 从 ${path} 成功加载统计数据`);
              break;
            }
          } catch (err) {
            console.warn(`⚠️ 尝试从 ${path} 加载失败:`, err.message);
          }
        }
        
        // 如果无法加载数据，返回null
        if (!loadSuccess) {
          console.warn('⚠️ 无法加载wiki_stats.json文件');
          return null;
        }
        
        // 更新总体统计信息
        if (statsData.summary) {
          document.getElementById('total-cves').textContent = statsData.summary.total_cves?.toLocaleString() || '加载中...';
          document.getElementById('days-running').textContent = statsData.summary.active_days || '计算中...';
        }
        
        // 渲染各个统计模块
        renderCWEClassification(statsData.cve_types || {});
        renderPOCExpStats(statsData.poc_exp_stats || {});
        renderVendorProductStats(statsData.vendor_product_stats || {});
        
        return statsData;
      } catch (error) {
        console.error('❌ 加载wiki统计数据失败:', error);
        showError('cwe-classification', '加载CVE分类数据失败');
        showError('poc-exp-stats', '加载POC/EXP统计数据失败');
        showError('vendor-product-stats', '加载厂商/产品统计数据失败');
        return null;
      }
    }
    
    // 渲染CWE分类统计
    function renderCWEClassification(cveTypes) {
      const container = document.getElementById('cwe-classification');
      
      // 计算总数
      const total = Object.values(cveTypes).reduce((sum, count) => sum + count, 0);
      
      if (total === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">📄 暂无CVE分类数据</div>';
        return;
      }
      
      // 定义颜色方案
      const colors = {
        '注入攻击': '#EF3A38',
        '路径遍历': '#ff6348',
        '远程代码执行': '#ff4757',
        '缓冲区溢出': '#ffa502',
        '跨站脚本': '#6c5ce7',
        '未授权访问': '#00b894',
        '信息泄露': '#0984e3',
        '其他类型': '#636e72'
      };
      
      let html = '<table class="trend-table" style="width: 100%; margin-bottom: 20px;">' +
                 '<thead><tr><th>类型</th><th>数量</th><th>占比</th></tr></thead><tbody>';
      
      // 按数量排序
      const sortedTypes = Object.entries(cveTypes)
        .sort(([,a], [,b]) => b - a)
        .filter(([, count]) => count > 0);
      
      sortedTypes.forEach(([type, count]) => {
        const percentage = ((count / total) * 100).toFixed(1);
        const color = colors[type] || '#6c5ce7';
        
        html += `<tr>
                  <td>${type}</td>
                  <td>${count}</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                      <div style="width: 100px; height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden;">
                        <div style="width: ${percentage}%; height: 100%; background: ${color};"></div>
                      </div>
                      <span>${percentage}%</span>
                    </div>
                  </td>
                </tr>`;
      });
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }
    
    // 渲染POC/EXP统计
    function renderPOCExpStats(pocExpStats) {
      const container = document.getElementById('poc-exp-stats');
      
      // 计算总数
      const total = Object.values(pocExpStats).reduce((sum, count) => sum + count, 0);
      
      if (total === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">📄 暂无POC/EXP统计数据</div>';
        return;
      }
      
      // 定义状态颜色
      const statusColors = {
        '仅POC': '#00b894',
        '仅EXP': '#EF3A38',
        'POC+EXP': '#ff6348',
        '无POC/EXP': '#636e72'
      };
      
      let html = '<table class="trend-table" style="width: 100%; margin-bottom: 20px;">' +
                 '<thead><tr><th>类型</th><th>数量</th><th>占比</th></tr></thead><tbody>';
      
      Object.entries(pocExpStats)
        .filter(([, count]) => count > 0)
        .forEach(([type, count]) => {
          const percentage = ((count / total) * 100).toFixed(1);
          const color = statusColors[type] || '#6c5ce7';
          
          html += `<tr>
                    <td>${type}</td>
                    <td>${count}</td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 100px; height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden;">
                          <div style="width: ${percentage}%; height: 100%; background: ${color};"></div>
                        </div>
                        <span>${percentage}%</span>
                      </div>
                    </td>
                  </tr>`;
        });
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }
    
    // 渲染厂商/产品统计
    function renderVendorProductStats(vendorProductStats) {
      const container = document.getElementById('vendor-product-stats');
      
      const { vendors = {}, products = {}, vendor_product_pairs = {} } = vendorProductStats;
      
      let html = '';
      
      // 渲染厂商统计
      if (Object.keys(vendors).length > 0) {
        const vendorTotal = Object.values(vendors).reduce((sum, count) => sum + count, 0);
        const sortedVendors = Object.entries(vendors)
          .sort(([,a], [,b]) => b - a)
          .slice(0, 15);
        
        html += `<div style="margin-bottom: 30px;">
                  <h4 style="color: #333; margin-top: 0; border-bottom: 2px solid #EF3A38; padding-bottom: 10px;">厂商统计Top 15</h4>
                  <table class="trend-table" style="width: 100%;">
                    <thead><tr><th>厂商</th><th>漏洞数量</th><th>占比</th></tr></thead><tbody>`;
        
        sortedVendors.forEach(([vendor, count]) => {
          const percentage = ((count / vendorTotal) * 100).toFixed(1);
          html += `<tr>
                    <td>${vendor}</td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                  </tr>`;
        });
        
        html += '</tbody></table></div>';
      }
      
      // 渲染产品统计
      if (Object.keys(products).length > 0) {
        const productTotal = Object.values(products).reduce((sum, count) => sum + count, 0);
        const sortedProducts = Object.entries(products)
          .sort(([,a], [,b]) => b - a)
          .slice(0, 15);
        
        html += `<div style="margin-bottom: 30px;">
                  <h4 style="color: #333; margin-top: 0; border-bottom: 2px solid #EF3A38; padding-bottom: 10px;">产品统计Top 15</h4>
                  <table class="trend-table" style="width: 100%;">
                    <thead><tr><th>产品</th><th>漏洞数量</th><th>占比</th></tr></thead><tbody>`;
        
        sortedProducts.forEach(([product, count]) => {
          const percentage = ((count / productTotal) * 100).toFixed(1);
          const displayProduct = product.length > 50 ? product.substring(0, 50) + '...' : product;
          html += `<tr>
                    <td title="${product}">${displayProduct}</td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                  </tr>`;
        });
        
        html += '</tbody></table></div>';
      }
      
      // 渲染厂商-产品组合统计
      if (Object.keys(vendor_product_pairs).length > 0) {
        const sortedPairs = Object.entries(vendor_product_pairs)
          .sort(([,a], [,b]) => b - a)
          .slice(0, 10);
        
        html += `<div style="margin-bottom: 20px;">
                  <h4 style="color: #333; margin-top: 0; border-bottom: 2px solid #EF3A38; padding-bottom: 10px;">厂商-产品组合Top 10</h4>
                  <table class="trend-table" style="width: 100%;">
                    <thead><tr><th>厂商 - 产品</th><th>漏洞数量</th></tr></thead><tbody>`;
        
        sortedPairs.forEach(([pair, count]) => {
          const displayPair = pair.length > 70 ? pair.substring(0, 70) + '...' : pair;
          html += `<tr>
                    <td title="${pair}">${displayPair}</td>
                    <td>${count}</td>
                  </tr>`;
        });
        
        html += '</tbody></table></div>';
      }
      
      if (!html) {
        html = '<div style="text-align: center; padding: 20px; color: #666;">📄 暂无厂商/产品统计数据</div>';
      }
      
      container.innerHTML = html;
    }
    
    // 显示错误信息
    function showError(elementId, message) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = `<div style="text-align: center; padding: 20px; color: #dc3545;">🚨 ${message}</div>`;
      }
    }
    
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', async function() {
      // 显示加载状态并开始调试
      document.getElementById('total-cves').textContent = '🔄 加载中...';
      document.getElementById('days-running').textContent = '🔄 计算中...';
      document.getElementById('system-uptime').textContent = '🔄 检测中...';
      document.getElementById('api-limit').textContent = '🔄 获取中...';
      
      console.log('🚀 开始加载GitHub CVE Monitor统计数据 (已认证)...');
      console.log('ℹ️ GitHub Token: 已配置，将使用5000次/小时的限制');
      
      await Promise.all([
        loadDynamicStats().catch(err => console.error('loadDynamicStats失败:', err)),
        loadStats().catch(err => console.error('loadStats失败:', err)),
        analyzeCVEData().catch(err => console.error('analyzeCVEData失败:', err)),
        loadDailyTrend().catch(err => console.error('loadDailyTrend失败:', err)),
        loadWikiStats().catch(err => console.error('loadWikiStats失败:', err))
      ]);
      
      // 移除"即将推出"区域
      const comingSoon = document.querySelector('.coming-soon');
      if (comingSoon) {
        comingSoon.style.display = 'none';
      }
    });
  </script>
</body>
</html>